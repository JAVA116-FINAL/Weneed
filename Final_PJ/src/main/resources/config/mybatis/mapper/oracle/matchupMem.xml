<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="config.mybatis.mapper.oracle.matchupMem">

	<!-- 자연 -->
	<select id="selectmcuResumeNo" parameterType="int" resultType="int">
		select resume_No from matchupMem where mem_No=#{memNo}
	</select>

	<select id="isMatchupMem" parameterType="int" resultType="int">
		select count(*) from matchupMem where mem_no=#{memNo}
	</select>
	
	<insert id="insertMcuMem" parameterType="matchupMemVo">
		<selectKey keyProperty="mcumemNo" resultType="int" order="BEFORE">
			select matchupMem_seq.nextVal from dual
		</selectKey>
		insert into matchupMem(mcumem_No, mem_No)
		values(#{mcumemNo}, #{memNo});
	</insert>

	<select id="selectMcuMem" parameterType="int">
		select * from matchupMem where mem_No=#{memNo}
	</select>

	
	<!-- 현빈 -->
	<select id="selectOpen" resultType="matchupMemVo">
		select * from matchupMem where resumeopen_flag='Y'
	</select> 
	
	<select id="selectMcumemNo" parameterType="int" resultType="int">
		select mcumem_no from matchupmem where resume_no=#{resumeNo}
	</select>
	
	<!-- 
	create or replace view matchupMemSearchView
	as
	select rownum as RNUM, A.*
	from
	(
	select m.mcumem_no, m.resume_no, m.mem_no, m.expertise_no, m.jobsearch_flag, m.resumeopen_flag,
	       r.resume_title, r.resume_name, r.resume_introduce, r.lang_flag, c.career_name, e.edu_name, e.edu_major,
	       x.jikGun_code, x.career, x.skill,
	       (select count(*) from matchuplike where mcumem_no=m.mcumem_no) as cnt
	from matchupMem m join resume r 
	on m.resume_No = r.resume_no 
	join career c on c.resume_no=m.resume_no
	join education e on e.resume_no=m.resume_no
	join expertise x on x.expertise_no=m.expertise_no
	where m.resumeopen_flag='Y'
	order by m.mcumem_no
	)A;
	 -->
	<select id="selectTenMem" parameterType="int" resultType="map">
		select * from matchupMemSearchView
		<![CDATA[
		    where RNUM > #{firstRecord}
		    and RNUM <= #{firstRecord}+5
		]]>
	</select>
	
	<!-- 여기.. 이렇게 하는게 맞을까.. 데이터가 더 필요하다.. 검색결과를 보려면 데이터가 필요한데.. 학력이랑 커리어랑.. 어떻게 넣지.. 하..ㅠㅠㅠ -->
	<select id="selectMcumemSearchList" parameterType="matchupMemSearchVo" resultType="map">
		select A.* 
	    from
	    (
	        select rownum as RN, m.* from matchupMemSearchView m
	        where mcumemNo in
	        <foreach collection="mcumemNoList" item="mcumemNo" open="(" close=")" separator=",">
				#{mcumemNo}
			</foreach>
		)A
		<![CDATA[
		where RN > #{viewMoreSize}
		and RN <= #{viewMoreSize}+5
		]]>
	</select>
</mapper>

<!-- 
select * from matchupMemSearchView
		where mcumemNo in
		<foreach collection="mcumemNoList" item="mcumemNo" open="(" close=")" separator=",">
			#{mcumemNo}
		</foreach>
		<![CDATA[
		    and RNUM > #{viewMoreSize}
		    and RNUM <= #{viewMoreSize}+5
		]]>
 -->









